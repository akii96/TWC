# SGLang GLM-4.7 on ROCm (AMD GPUs)
# ==================================
# Preset for stress testing GLM-4.7-FP8 on AMD MI300X GPUs with SGLang.
#
# Usage:
#   ./stress_test.sh --config presets/sglang-glm4-rocm.yaml

framework: sglang

docker:
  image: sglang:rocm720-mi30x-20260217-patched
  shm_size: 128G
  network: host
  devices:
    - /dev/kfd
    - /dev/dri

env:
  SAFETENSORS_FAST_GPU: 1

server:
  port: 30000
  startup_timeout: 2700
  model_path: zai-org/GLM-4.7-FP8

server_args:
  tp-size: 8
  mem-fraction-static: 0.8
  tool-call-parser: glm47
  reasoning-parser: glm45

timeouts:
  container: 4800
  prompt: 240

test:
  mode: server
  num_loops: 50
  prompts_per_loop: 3
  success_pattern: "yes"

error_patterns:
  - HSA_STATUS_ERROR_EXCEPTION
  - OutOfMemoryError
  - RuntimeError
  - Memory access fault

workspace:
  base_dir: "$HOME"
  mounts:
    - .cache
    - data
